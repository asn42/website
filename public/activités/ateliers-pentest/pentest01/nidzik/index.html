
<!doctype html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <title>write up de nidzik - Association Sans Nom - Libre et sécurité à 42</title>
        <meta name="description" content="ASN, l'association étudiante de 42 pour tout ce qui touche au Libre et à la sécurité !">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="manifest" href="/site.webmanifest">
        <link rel="apple-touch-icon" href="/icon.png">
        <link rel="icon" href="/favicon.ico">

        <link rel="alternate" type="application/rss+xml" title="RSS" href="&#x2F;rss.xml">


        <link rel="stylesheet" href="/main.css">

    </head>
    <body>

        <nav id="menu">
            <a href="/">
                <img src="/images/logo.svg" alt="Logo ASN">
                <div>
                    <h1>Association Sans Nom</h1>
                    <p>Libre et Sécurité à 42</p>
                </div>
            </a>
            <a href="/contact/">Nous contacter</a>
            <a href="/activités/">Activités</a>
            <a href="/#adherer">Devenir membre</a>
            <a href="/statuts/">Statuts</a>
        </nav>
        <nav id="context">

  
    
    <a href="/">asn</a>
  
    
    <a href="/activités/">nos activités</a>
  
    
    <a href="/activités/ateliers-pentest/">ateliers pentest</a>
  
    
    <a href="/activités/ateliers-pentest/pentest01/">premier atelier pentest</a>
  
  
    <a>write up de nidzik</a>

        </nav>
        <main class="container">

<section id="points">
  
  
  
score: 130 / 130
  
</section>
<section id="writeup">

<section id="page">
<h2 id="first-of-all-do-a-scan-of-the-network-to-find-the-ip-of-th-vm">First of all do a scan of the network to find the ip of th vm:</h2>
<h3 id="arp-scan">arp-scan</h3>
<pre style="background-color:#2b303b;">
<span style="color:#bf616a;">arp-scan -l -I</span><span style="color:#c0c5ce;"> eth0
</span></pre>
<ul>
<li><code>-l --localnet</code> generate addresses from the local network</li>
<li><code>-I</code> specify the network interface</li>
</ul>
<p><img src="./Screen_Shot_2018_03_05_at_23_29_47.png" alt="arp scan" /></p>
<ul>
<li><code>10.0.2.1/3</code> are used by virtualbox.</li>
<li><code>10.0.2.7</code> this one is instersting !</li>
</ul>
<h2 id="scan-for-the-most-commons-names">Scan for the most commons names</h2>
<h3 id="dirb">dirb</h3>
<pre style="background-color:#2b303b;">
<span style="color:#bf616a;">dirb</span><span style="color:#c0c5ce;"> http://10.0.2.7
</span></pre>
<p>by defaut dirb scan the port 80.</p>
<p><img src="./dirb.png" alt="dirb scan" /></p>
<p><code>http://10.0.2.7/passwords/</code> that must be good..</p>
<h3 id="checking-the-passwords-direcory">Checking the passwords/ direcory</h3>
<hr />
<p><img src="./passwords_dir.png" alt="URL http://10.0.2.7/password/" /></p>
<p>Is that the frist flag ??</p>
<p><img src="./passwords_flag.png" alt="FLAG.txt file containing a flag" /></p>
<p>Yes it is, nice ! Let's go on.
We'll now check the other page:</p>
<p><img src="./passwords_0.png" alt="Texte in http://10.0.2.7/passwords/passwords.html" /></p>
<p>Humm.. nothing here but there was a password but Rick has hidden it.
and if we looking for hidden things..</p>
<p><img src="./passwords_1.png" alt="Password in a HTML comment" /></p>
<p>hidden things we found !!</p>
<ul>
<li>we've got a password <code>winter</code> let's keept that in mind.</li>
</ul>
<hr />
<h3 id="checking-the-robot-txt-file">Checking the robot.txt file</h3>
<p><img src="./robots.png" alt="Content of /robot.txt" /></p>
<p><code>root_shell.cgi</code> looks nice but it's a fake, there is nothing.</p>
<p>maybe we'll get more luck with <code>tracertool.cgi</code></p>
<p><img src="./trace.png" alt="HTML form using user input" /></p>
<p>if we submit a random value like <code>AAAAAAAAAAAA</code> it print nothing
but if we give a good parameter to the Morty's tracertool it returns <code>traceroute to localhost (127.0.0.1)</code></p>
<ul>
<li>traceroute is a linux cmd.</li>
</ul>
<p>*That's mean somehow there is a command executed in the shell.</p>
<ul>
<li>So maybe we can use the propriety of the shell to get more liberty with this tool.
We can try to use the <code>;</code></li>
</ul>
<p><img src="./trace1.png" alt=";ls in the form runs ls" /></p>
<p><img src="./traceid.png" alt=";id in the form runs id" /></p>
<p>lets take a look at the <code>/etc/passwd</code> file</p>
<p><img src="./tracecat.png" alt=";cat in the form print an ascii cat" /></p>
<p>oops <code>cat</code> seems broken ^^ <code>tail</code> is a good alternative</p>
<p><img src="./tracetail.png" alt=";tail /etc/password" /></p>
<p>We have now 3 username: <code>RickSanchez</code> <code>Morty</code> <code>Summer</code></p>
<hr />
<h3 id="quick-step-back-why-can-we-execute-several-commands-with">quick step back, why can we execute several commands with <code>;</code></h3>
<p>take a look at the source code of <code>tracertool.cgi</code></p>
<p><img src="./tracecode.png" alt=";tail tracertool.cgi" /></p>
<ul>
<li>it first &quot;reverse&quot; the html encoding with several <code>sed</code></li>
<li>then <code>eval</code> of <code>traceroute + $our_string</code></li>
</ul>
<p>from the man:</p>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">eval
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">Evaluate several commands/arguments
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">Syntax
</span><span style="color:#c0c5ce;">      </span><span style="color:#c0c5ce;">eval [arguments]
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">The arguments are concatenated together into a single command, which is then
</span><span style="color:#c0c5ce;">read and executed, and its exit status returned as the exit status of eval.
</span><span style="color:#c0c5ce;">If there are no arguments or only empty arguments, the return status is zero. 
</span></pre>
<p>that mean eval just give the whole chain to bash and this one interpret it.</p>
<hr />
<p>we can't do much more with the apache user.</p>
<h2 id="more-scans">More Scans ..</h2>
<h3 id="nmap">nmap</h3>
<pre style="background-color:#2b303b;">
<span style="color:#bf616a;">nmap -p- -T5 -A -sV</span><span style="color:#c0c5ce;"> 10.0.2.7
</span></pre>
<ul>
<li>
<p><code>-p-</code> scan from port 1 to port 65586</p>
</li>
<li>
<p><code>-T5</code> to scan faster</p>
</li>
<li>
<p><code>-A</code> which turns on version detection and other Advanced and Aggressive features</p>
</li>
<li>
<p><code>-sV</code> To enable version detection</p>
</li>
</ul>
<p><img src="./nmap.png" alt="Scan with nmap" /></p>
<h3 id="port-21">Port 21</h3>
<p>ftp classic, we can see we have acces to the anonymous user and there is probably a flag here:</p>
<p><img src="./ftp.png" alt="Connect to the FTP server anonymously and download FLAG.txt" /></p>
<h3 id="port-22">Port 22</h3>
<p>nmap guess that is a ssh port because it's on port 22 but it's not.</p>
<h3 id="port-9090">Port 9090</h3>
<p>just check it on your browser:</p>
<p><img src="./9090.png" alt="Fedora graphical login screen with a flag in it" /></p>
<p>nice one more !</p>
<h3 id="port-60000">Port 60000</h3>
<p>reverse shell from Rick.
let's try to connect with <code>nc</code></p>
<p><img src="./revshell.png" alt="Connect with nc and cat FLAG.txt" /></p>
<h3 id="port-22222">Port 22222</h3>
<p>ssh port, we need a username and a password.
so far we discover 3 usernames <code>RickSnachez</code> <code>Morty</code> <code>Summer</code> and one password <code>winter</code> (:80/passwords/passwords.html)</p>
<p><img src="./ssh.png" alt="Try to log in as Morty (fails), then Summer (success)" /></p>
<p>nice one more flag found and we are on the machine !
with some digging we find out that we have the right permissions to access to Morty's home.
Morty has a zip file protected by a password. And an img who's probably hide the password.
the password seems to look like <code>Meeseek</code></p>
<p><img src="./zip.png" alt="head Safe_Password.jpeg reveals the password in EXIF data" /></p>
<p>all right ! next step hack Rick's safe !
after some trys i realize that the flag we got right before is a little weird</p>
<p><img src="./safe.png" alt="Generate all matching passwords with a python script" /></p>
<p>we got a hint for the last lvl
just create a passwd list with this pattern:
UP_LETTER + DIGIT + Curtains (the band group is The Flesh Curtain, and curtains seems right for the passwd )
a little and dirty python script  + <code>hydra</code></p>
<p><img src="./lastone.png" alt="Try the ssh passwords with hydra" /></p>
<p><img src="./lasttwo.png" alt="login as RickSanchez, then root, then tail the FLAG.txt file" /></p>
<p>Root -- Last Flag :D</p>
<p><img src="./root.png" alt="alt-text" /></p>

</section>

</section>

        </main>

        <footer id="footer">
            <p><span class="copyleft">Copyleft</span> 2017-2018 Association Sans Nom et contributeurs - <a href="https://github.com/asn42/website">code source</a></p>
        </footer>




    </body>
</html>
